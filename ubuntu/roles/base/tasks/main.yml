---
- name: ensure resolved.conf.d directory
  ansible.builtin.file:
    path: /etc/systemd/resolved.conf.d
    owner: root
    group: root
    mode: 0755
    state: directory

- name: copy custom systemd-resolved configuration
  ansible.builtin.copy:
    src: resolved.conf
    dest: /etc/systemd/resolved.conf.d/dns.conf
    owner: root
    group: root
    mode: 0644
  notify:
    - restart systemd-resolved

- name: ensure manual dependencies
  ansible.builtin.apt:
    name:
      - ansible
      - curl
      - git
    update_cache: yes

- name: install apt https transport
  ansible.builtin.apt: name=apt-transport-https

# - name: add supermario ppa
#   ansible.builtin.apt_repository: repo=ppa:mfinelli/supermario

- name: add supermario ppa
  ansible.builtin.template:
    dest: /etc/apt/sources.list.d/supermario.list
    owner: root
    group: root
    mode: 0644
    src: supermario.list.j2

- name: install new sources list
  when: mtype != 'server'
  ansible.builtin.template:
    dest: /etc/apt/sources.list
    owner: root
    group: root
    mode: 0664
    src: sources.list.j2

- name: install base packages
  ansible.builtin.apt:
    name:
      - fd-find
      - fzf
      - htop
      - jq
      - libarchive-tools
      - moreutils
      - neofetch
      - pv
      - pwgen
      - ripgrep
      - silversearcher-ag
      - thefuck
      - universal-ctags
      - urlwatch
      - vim
      - whois
    update_cache: yes
