---
- name: Install kubectl
  ansible.builtin.get_url:
    dest: /usr/local/bin/kubectl
    group: root
    mode: "0755"
    owner: root
    url: https://storage.googleapis.com/kubernetes-release/release/v{{ kubectl_version }}/bin/linux/amd64/kubectl
  notify:
    - Install kubectl bash completion
    - Install kubectl zsh completion

- name: Install helm
  ansible.builtin.unarchive:
    dest: /usr/local/bin
    extra_opts:
      - --strip-components=1
    group: root
    mode: "0755"
    owner: root
    remote_src: true
    src: https://get.helm.sh/helm-v{{ helm_version }}-linux-amd64.tar.gz
  notify:
    - Install helm bash completion
    - Install helm zsh completion

- name: Remove extra helm files
  ansible.builtin.file:
    path: /usr/local/bin/{{ item }}
    state: absent
  loop:
    - LICENSE
    - README.md

- name: Install helmfile
  ansible.builtin.get_url:
    dest: /usr/local/bin/helmfile
    group: root
    mode: "0755"
    owner: root
    url: https://github.com/roboll/helmfile/releases/download/v{{ helmfile_version }}/helmfile_linux_amd64

- name: Install kubectx
  ansible.builtin.include_tasks: kubectx.yml
