---
- name: Install full disk encryption dependencies
  ansible.builtin.apt:
    name:
      - busybox
      - cryptsetup
      - initramfs-tools

- name: Install gparted for formatting USB drives
  ansible.builtin.apt:
    name: gparted

- name: Install kernel initramfs rebuild script
  ansible.builtin.copy:
    dest: /etc/kernel/postinst.d/initramfs-rebuild
    owner: root
    group: root
    mode: "0755"
    src: initramfs-rebuild.sh
  notify:
    - Rebuild initramfs

- name: Install initramfs luks hooks script
  ansible.builtin.copy:
    dest: /etc/initramfs-tools/hooks/luks
    owner: root
    group: root
    mode: "0755"
    src: luks.sh
  notify:
    - Rebuild initramfs

- name: Install initramfs modules list
  ansible.builtin.copy:
    dest: /etc/initramfs-tools/modules
    owner: root
    group: root
    mode: "0644"
    src: modules
  notify:
    - Rebuild initramfs
